# Reports Module

Hệ thống báo cáo (Report System) cho blog, tương tự như các hệ thống báo cáo của TikTok, Facebook, v.v.

## Tính năng chính

### 1. Tạo báo cáo
- Người dùng có thể báo cáo nội dung không phù hợp
- Hỗ trợ nhiều loại nội dung: articles, comments, users, media, stickers, posts
- Nhiều lý do báo cáo: spam, harassment, hate speech, violence, v.v.
- Ưu tiên tự động dựa trên lý do báo cáo

### 2. Quản lý báo cáo (Moderator)
- Xem danh sách báo cáo với phân trang và lọc
- Gán báo cáo cho moderator
- Xử lý báo cáo: resolve, dismiss, escalate
- Tạo action cho báo cáo
- Merge các báo cáo trùng lặp

### 3. Thống kê và báo cáo
- Thống kê tổng quan về báo cáo
- Phân tích theo trạng thái, ưu tiên, loại nội dung, lý do
- Top reporters và moderators
- Xu hướng báo cáo theo thời gian

## API Endpoints

### Public Endpoints (Cần authentication)
- `POST /reports` - Tạo báo cáo mới
- `GET /reports/my` - Xem báo cáo của mình

### Moderator/Admin Endpoints
- `GET /reports` - Danh sách báo cáo (có phân trang và lọc)
- `GET /reports/:id` - Chi tiết báo cáo
- `PUT /reports/:id` - Cập nhật báo cáo
- `POST /reports/:id/assign` - Gán báo cáo cho moderator
- `POST /reports/:id/resolve` - Giải quyết báo cáo
- `POST /reports/:id/dismiss` - Bỏ qua báo cáo
- `POST /reports/:id/escalate` - Chuyển báo cáo lên cấp cao hơn
- `POST /reports/:id/actions` - Tạo action cho báo cáo
- `GET /reports/content/:type/:id` - Báo cáo cho nội dung cụ thể
- `GET /reports/duplicates/:type/:id` - Báo cáo trùng lặp
- `POST /reports/merge` - Merge báo cáo trùng lặp
- `GET /reports/stats` - Thống kê báo cáo
- `GET /reports/assigned` - Báo cáo được gán cho tôi
- `GET /reports/pending` - Báo cáo đang chờ xử lý
- `GET /reports/urgent` - Báo cáo khẩn cấp

## Cấu trúc dữ liệu

### Report Entity
```typescript
{
  id: string;
  reporterId: string;
  reportableType: 'article' | 'comment' | 'user' | 'media' | 'sticker' | 'post';
  reportableId: string;
  reason: string; // spam, harassment, hate_speech, etc.
  description?: string;
  status: 'pending' | 'under_review' | 'resolved' | 'dismissed' | 'escalated';
  priority: 'low' | 'medium' | 'high' | 'urgent';
  moderatorId?: string;
  action?: string;
  moderatorNotes?: string;
  resolution?: string;
  resolutionDetails?: string;
  assignedAt?: Date;
  resolvedAt?: Date;
  duplicateCount: number;
  isAutoGenerated: boolean;
  metadata?: Record<string, any>;
  createdAt: Date;
  updatedAt: Date;
}
```

### ReportAction Entity
```typescript
{
  id: string;
  reportId: string;
  moderatorId: string;
  action: string; // content_removed, user_warned, etc.
  description?: string;
  notes?: string;
  metadata?: Record<string, any>;
  createdAt: Date;
  updatedAt: Date;
}
```

## Các lý do báo cáo

### Nội dung
- `spam` - Spam
- `harassment` - Quấy rối
- `hate_speech` - Ngôn từ thù địch
- `violence` - Bạo lực
- `sexual_content` - Nội dung tình dục
- `nudity` - Khoả thân
- `graphic_violence` - Bạo lực đồ họa
- `misinformation` - Thông tin sai lệch
- `fake_news` - Tin giả
- `copyright_violation` - Vi phạm bản quyền
- `inappropriate_content` - Nội dung không phù hợp
- `offensive_language` - Ngôn từ xúc phạm
- `bullying` - Bắt nạt
- `threats` - Đe dọa
- `terrorism` - Khủng bố
- `extremism` - Cực đoan
- `child_abuse` - Lạm dụng trẻ em
- `self_harm` - Tự hại
- `suicide` - Tự tử
- `drug_abuse` - Lạm dụng ma túy
- `weapons` - Vũ khí
- `illegal_activities` - Hoạt động bất hợp pháp
- `privacy_violation` - Vi phạm quyền riêng tư
- `doxxing` - Doxxing
- `stalking` - Theo dõi

### Người dùng
- `fake_account` - Tài khoản giả
- `underage_user` - Người dùng vị thành niên
- `suspicious_activity` - Hoạt động đáng ngờ
- `account_takeover` - Chiếm quyền tài khoản

### Kỹ thuật
- `bug_report` - Báo lỗi
- `feature_request` - Yêu cầu tính năng
- `performance_issue` - Vấn đề hiệu suất
- `accessibility_issue` - Vấn đề tiếp cận

## Các hành động xử lý

- `no_action` - Không có hành động
- `warning` - Cảnh báo
- `content_removed` - Xóa nội dung
- `content_hidden` - Ẩn nội dung
- `content_edited` - Chỉnh sửa nội dung
- `user_warned` - Cảnh báo người dùng
- `user_suspended` - Đình chỉ người dùng
- `user_banned` - Cấm người dùng
- `account_deleted` - Xóa tài khoản
- `escalated_to_admin` - Chuyển lên admin
- `escalated_to_legal` - Chuyển lên pháp lý
- `report_dismissed` - Bỏ qua báo cáo
- `report_merged` - Merge báo cáo
- `report_duplicate` - Đánh dấu trùng lặp

## Tự động hóa

### Auto-escalation
- Báo cáo về `child_abuse`, `terrorism`, `suicide` sẽ được tự động chuyển lên cấp cao hơn
- Báo cáo có 10+ báo cáo trùng lặp sẽ được tự động chuyển lên

### Auto-resolution
- 5+ báo cáo spam sẽ được tự động giải quyết
- 3+ báo cáo tương tự sẽ được tự động merge

## Cache và Performance

- Cache thống kê trong 1 giờ
- Cache báo cáo trong 5 phút
- SWR (Stale-While-Revalidate) trong 60 giây
- Tự động xóa cache khi có thay đổi

## Events và Notifications

Hệ thống sử dụng RabbitMQ để gửi events:
- `report_created` - Báo cáo được tạo
- `report_updated` - Báo cáo được cập nhật
- `report_action_created` - Action được tạo
- `report_assigned` - Báo cáo được gán
- `report_resolved` - Báo cáo được giải quyết
- `report_dismissed` - Báo cáo bị bỏ qua
- `report_escalated` - Báo cáo được chuyển lên
- `report_merged` - Báo cáo được merge

## Security

- Chỉ moderator và admin mới có thể xem và xử lý báo cáo
- Người dùng chỉ có thể xem báo cáo của mình
- Validation đầy đủ cho tất cả input
- Rate limiting để tránh spam báo cáo

## Testing

- Unit tests cho service và controller
- Integration tests cho API endpoints
- Mock tất cả dependencies
- Test coverage > 90%

## Usage Examples

### Tạo báo cáo
```typescript
const report = await reportsService.createReport('user123', {
  reportableType: 'article',
  reportableId: 'article456',
  reason: 'spam',
  description: 'This article contains spam content',
  priority: 'medium'
});
```

### Xử lý báo cáo
```typescript
// Gán báo cáo
await reportsService.assignReport('report123', 'moderator456');

// Giải quyết báo cáo
await reportsService.resolveReport('report123', 'moderator456', {
  action: 'content_removed',
  resolution: 'resolved',
  resolutionDetails: 'Content removed and user warned',
  moderatorNotes: 'User warned about future violations'
});

// Bỏ qua báo cáo
await reportsService.dismissReport('report123', 'moderator456', 'No violation found');
```

### Lấy thống kê
```typescript
const stats = await reportsService.getStats({
  status: 'pending',
  startDate: '2024-01-01T00:00:00Z',
  endDate: '2024-12-31T23:59:59Z',
  groupBy: 'day'
});
```
